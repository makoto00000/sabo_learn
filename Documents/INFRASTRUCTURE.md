# インフラ

## 構成図

![インフラ構成図](https://github.com/makoto00000/sabo_learn/assets/65654634/2470a976-a153-474b-9948-e513685ec03b)

## 選定理由

### Amplify

Next.jsを使った開発のため、Vercelへのデプロイも考えましたが20ドル/月かかります。ユーザー数が少ないうちはAWSを使う方が料金を抑えられるためAWSのサービスを使用しました。Cloudfront + S3を自分で構築する方法もありますが、実装期間が限られていることもあり、簡便にgithubと連携してプルリクベースでデプロイもできるAmplifyを選択しました。

### Certificate Manager

https通信を行うため、SSL/TLS証明書を管理しています。

### Route53

お名前.comで取得したドメインをルーティングさせています。フロント用とバックエンド用にサブドメインを設定しました。

### Application Load Barancer

障害時やオートスケール時の入力トラフィックを適切なコンテナに分散させています。

### ECR/ECS(Fargate)

Dockerベースでの開発を行ったため、ECRを採用しました。ECSを選択することで、EC2に比べてインフラの管理がラクになるのが最大のメリットです。もう一つの採用理由はECSを使った構成をやったことがないためというのがあります。運用コストのことを考えると、Fargateを採用することで、パフォーマンスに対するコンピューティングコストは、ECS on EC2に比べると割高になってしまうため、今後の検討が必要ではある部分だと考えています。

## CI/CD

### フロントエンド

Amplifyをgithubと連携しており、mainブランチにマージすると自動でデプロイが実行されます。

### バックエンド

Github Actionsを導入しており、プルリクエスト時にテストが実行されます。テストにはRspecを導入しており、基本的なバックエンドの単体テスト、結合テストを記述しました。またRubocopも実行されるようになっており、コードの品質を担保しています。
現在は、ECRへのpush、ECSへのデプロイが手動なので、Github Actionsを使って全て自動化させるところまで実装します。

## 監視

現在未実装。エラー監視ツールを導入し、いち早く不具合に対応できるようにする。
